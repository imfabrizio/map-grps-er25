<!DOCTYPE html>
<html>
<head>
    <title>Percorso Gara di Primo Soccorso</title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css">
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
    <style>
        html, body, #map { height: 100%; margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        const map = new atlas.Map('map', {
            center: [44.4603971115963, 10.52188556692596],
            zoom: 16,
            authOptions: {
                authType: 'subscriptionKey',
                subscriptionKey: 'BAqgYkgcYKIiyJfr7BOGSIFySA2Yw14pckF6xDum7uUvMptUSF19JQQJ99BFAC5RqLJioKNfAAAgAZMP45SF'
            }
        });

        map.events.add('ready', function () {
            const stazioni = [
                { pos: [44.4603971115963, 10.52188556692596], titolo: "Sede Croce Rossa" },
                { pos: [44.463778, 10.520888], titolo: "Scenza CHARLIE" },
                { pos: [44.4521687, 10,5172802], titolo: "Scena DELTA" },
                { pos: [44.4534773, 10.5186218], titolo: "Scena ECHO" },
                { pos: [44.4542510, 10.5189889], titolo: "Scena ALFA" },
                { pos: [44.4555097, 10.5177559], titolo: "Scena BRAVO" }
            ];

            const positions = [];

            stazioni.forEach(s => {
                positions.push(s.pos);
                const marker = new atlas.HtmlMarker({
                    position: s.pos,
                    text: "⛑️",
                    color: "red"
                });
                map.markers.add(marker);

                const popup = new atlas.Popup({
                    content: `<div style="padding:5px;"><strong>${s.titolo}</strong></div>`,
                    position: s.pos
                });

                map.events.add('click', marker, () => popup.open(map));
            });

            const line = new atlas.data.LineString(positions);
            const shape = new atlas.Shape(new atlas.data.Feature(line));
            const source = new atlas.source.DataSource();
            map.sources.add(source);
            source.add(shape);

            const layer = new atlas.layer.LineLayer(source, null, {
                strokeColor: "blue",
                strokeWidth: 4
            });
            map.layers.add(layer);
        });
    </script>
</body>
</html>
